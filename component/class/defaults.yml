parameters:
  billing_collector_cloudservices:
    =_metadata:
      multi_instance: true

    namespace: appuio-cloud-reporting

    database: ${appuio_cloud_reporting:database}
    database_secret: ${appuio_cloud_reporting:database_secret}
    database_env: ${appuio_cloud_reporting:database_env}
    extra_volumes: ${appuio_cloud_reporting:extra_volumes}

    cloud_reporting_dbsecret_name: reporting-db

    secrets:
      exoscale:
        credentials:
          stringData:
            EXOSCALE_API_KEY: "?{vaultkv:${cluster:tenant}/${cluster:name}/billing-collector-cloudservices/${_instance}/exoscale-key}"
            EXOSCALE_API_SECRET: "?{vaultkv:${cluster:tenant}/${cluster:name}/billing-collector-cloudservices/${_instance}/exoscale-secret}"
            KUBERNETES_SERVER_URL: "?{vaultkv:${cluster:tenant}/${cluster:name}/billing-collector-cloudservices/${_instance}/cluster-server}"
            KUBERNETES_SERVER_TOKEN: "?{vaultkv:${cluster:tenant}/${cluster:name}/billing-collector-cloudservices/${_instance}/cluster-token}"
      cloudscale:
        credentials:
          stringData:
            CLOUDSCALE_API_TOKEN: "?{vaultkv:${cluster:tenant}/${cluster:name}/billing-collector-cloudservices/${_instance}/token}"
            KUBERNETES_SERVER_URL: "?{vaultkv:${cluster:tenant}/${cluster:name}/billing-collector-cloudservices/${_instance}/cluster-server}"
            KUBERNETES_SERVER_TOKEN: "?{vaultkv:${cluster:tenant}/${cluster:name}/billing-collector-cloudservices/${_instance}/cluster-token}"
    images:
      collector:
        registry: 'ghcr.io'
        repository: 'vshn/billing-collector-cloudservices'
        tag: v1.0.3

    exoscale:
      enabled: false
      objectStorage:
        enabled: true
        # Times in UTC! Don't run job around midnight as exoscale API may return incomplete data
        # schedule for objectstorage cronjob
        # default: Every day at minute 10 past hour 10, 16 and 20.
        schedule: '10 10,16,20 * * *'

      dbaas:
        # enable DBaaS cronjob in addition to objectstorage cronjob.
        enabled: false
        # schedule for DBaaS cronjob every 15min
        schedule: '*/15 * * * *'

    cloudscale:
      enabled: false
      objectStorage:
        enabled: true
        # Times in UTC!
        schedule: '10 4,10,16 * * *'
